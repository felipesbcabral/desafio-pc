<div class="debt-table-container">
  <!-- Table Header Actions -->
  <div class="table-header">
    <div class="table-info">
      <h3 class="table-title">
        <mat-icon>list_alt</mat-icon>
        Títulos de Dívida
      </h3>
      <span class="table-count" *ngIf="!loading">
        {{ totalCount | number:'1.0-0':'pt-BR' }} títulos encontrados
      </span>
    </div>
    
    <div class="table-actions">
      <button 
        mat-stroked-button 
        color="primary" 
        (click)="exportToCSV()" 
        [disabled]="loading || data.length === 0"
        matTooltip="Exportar dados para CSV">
        <mat-icon>download</mat-icon>
        Exportar
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p class="loading-text">Carregando títulos...</p>
  </div>

  <!-- Table Container -->
  <div class="table-wrapper" [class.table-wrapper--loading]="loading">
    <table 
      mat-table 
      [dataSource]="dataSource" 
      matSort 
      class="debt-table">
      
      <!-- Title Number Column -->
      <ng-container matColumnDef="titleNumber">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="column-title-number">
          <div class="header-content">
            <mat-icon>confirmation_number</mat-icon>
            <span>Número do Título</span>
          </div>
        </th>
        <td mat-cell *matCellDef="let debt" class="column-title-number">
          <div class="cell-content">
            <span class="title-number">{{ debt.titleNumber }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Debtor Name Column -->
      <ng-container matColumnDef="debtorName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="column-debtor-name">
          <div class="header-content">
            <mat-icon>person</mat-icon>
            <span>Nome do Devedor</span>
          </div>
        </th>
        <td mat-cell *matCellDef="let debt" class="column-debtor-name">
          <div class="cell-content">
            <span class="debtor-name">{{ debt.debtorName }}</span>
            <span class="debtor-document">{{ debt.debtorDocument }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Installment Count Column -->
      <ng-container matColumnDef="installmentCount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="column-installments">
          <div class="header-content">
            <mat-icon>format_list_numbered</mat-icon>
            <span>Parcelas</span>
          </div>
        </th>
        <td mat-cell *matCellDef="let debt" class="column-installments">
          <div class="cell-content">
            <span class="installment-count">{{ formatNumber(debt.installmentCount) }}</span>
            <span class="installment-label">parcela(s)</span>
          </div>
        </td>
      </ng-container>

      <!-- Original Value Column -->
      <ng-container matColumnDef="originalValue">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="column-value">
          <div class="header-content">
            <mat-icon>account_balance_wallet</mat-icon>
            <span>Valor Original</span>
          </div>
        </th>
        <td mat-cell *matCellDef="let debt" class="column-value">
          <div class="cell-content">
            <span class="value-amount">{{ formatCurrency(debt.originalValue) }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Days Overdue Column -->
      <ng-container matColumnDef="daysOverdue">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="column-overdue">
          <div class="header-content">
            <mat-icon>schedule</mat-icon>
            <span>Dias em Atraso</span>
          </div>
        </th>
        <td mat-cell *matCellDef="let debt" class="column-overdue">
          <div class="cell-content">
            <div class="overdue-info" [class]="getStatusClass(debt)">
              <span class="overdue-days">{{ formatNumber(debt.daysOverdue) }}</span>
              <span class="overdue-label">dias</span>
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Updated Value Column -->
      <ng-container matColumnDef="updatedValue">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="column-value">
          <div class="header-content">
            <mat-icon>trending_up</mat-icon>
            <span>Valor Atualizado</span>
          </div>
        </th>
        <td mat-cell *matCellDef="let debt" class="column-value">
          <div class="cell-content">
            <span class="value-amount value-updated">{{ formatCurrency(debt.updatedValue) }}</span>
            <span class="value-percentage" [class]="getStatusClass(debt)" *ngIf="debt.isOverdue">
              +{{ getOverduePercentage(debt) | number:'1.1-1':'pt-BR' }}%
            </span>
          </div>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef class="column-status">
          <div class="header-content">
            <mat-icon>info</mat-icon>
            <span>Status</span>
          </div>
        </th>
        <td mat-cell *matCellDef="let debt" class="column-status">
          <div class="cell-content">
            <mat-chip class="status-chip" [class]="getStatusClass(debt)">
              <mat-icon class="status-icon">{{ getStatusIcon(debt) }}</mat-icon>
              <span>{{ getStatusLabel(debt) }}</span>
            </mat-chip>
          </div>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="column-actions">
          <div class="header-content">
            <mat-icon>more_horiz</mat-icon>
            <span>Ações</span>
          </div>
        </th>
        <td mat-cell *matCellDef="let debt" class="column-actions">
          <div class="cell-content">
            <button 
              mat-icon-button 
              [matMenuTriggerFor]="actionsMenu"
              [matTooltip]="'Ações para ' + debt.titleNumber"
              (click)="$event.stopPropagation()">
              <mat-icon>more_vert</mat-icon>
            </button>
            
            <mat-menu #actionsMenu="matMenu">
              <button 
                mat-menu-item 
                (click)="onActionClick('view', debt, $event)">
                <mat-icon>visibility</mat-icon>
                <span>Visualizar Detalhes</span>
              </button>
              
              <button 
                mat-menu-item 
                (click)="onActionClick('edit', debt, $event)">
                <mat-icon>edit</mat-icon>
                <span>Editar</span>
              </button>
              
              <button 
                mat-menu-item 
                (click)="onActionClick('installments', debt, $event)">
                <mat-icon>format_list_numbered</mat-icon>
                <span>Ver Parcelas</span>
              </button>
              
              <mat-divider></mat-divider>
              
              <button 
                mat-menu-item 
                (click)="onActionClick('export', debt, $event)">
                <mat-icon>download</mat-icon>
                <span>Exportar</span>
              </button>
            </mat-menu>
          </div>
        </td>
      </ng-container>

      <!-- Table Header and Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr 
        mat-row 
        *matRowDef="let debt; columns: displayedColumns; trackBy: trackByDebtId"
        class="debt-row"
        [class.debt-row--overdue]="debt.isOverdue"
        [class.debt-row--critical]="debt.daysOverdue > 90"
        [attr.aria-label]="getRowAriaLabel(debt)"
        [attr.tabindex]="0"
        (click)="onRowClick(debt)"
        (keydown)="onKeyDown($event, debt)">
      </tr>
    </table>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && data.length === 0">
    <div class="empty-state-content">
      <mat-icon class="empty-state-icon">inbox</mat-icon>
      <h3 class="empty-state-title">Nenhum título encontrado</h3>
      <p class="empty-state-description">
        Não há títulos de dívida que correspondam aos filtros aplicados.
        Tente ajustar os critérios de busca.
      </p>
    </div>
  </div>

  <!-- Pagination -->
  <mat-paginator 
    *ngIf="!loading && data.length > 0"
    [length]="totalCount"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    [showFirstLastButtons]="true"
    class="debt-paginator">
  </mat-paginator>
</div>